# 指板图交互说明文档

## 音符状态说明

### 1. 普通状态（Normal State）

普通状态是音符的默认状态，具有以下特征：

- **颜色**：白色（`white`）
- **可见性**：根据全局 Toggle 设置
  - `transparent`：半透明显示（默认）
  - `hidden`：完全隐藏
- **外观**：与背景融合，不突出显示

### 2. Visible 状态

Visible 状态表示音符被高亮显示，具有以下特征：

- **颜色**：可以是任意颜色（蓝色、绿色、红色、白色、黑色）
- **可见性**：`visible`（完全不透明，清晰可见）
- **外观**：颜色填充，文字清晰，非常醒目

### 3. Selected 状态

Selected 状态表示音符被选中，具有以下特征：

- **颜色**：保持原有颜色
- **可见性**：`selected`（带虚线边框）
- **外观**：带有虚线边框，表示当前选中项
- **用途**：用于编辑、删除等操作

## 调色盘交互逻辑

### 调色盘按钮

调色盘包含以下颜色选项：
- **蓝色**（Blue）
- **绿色**（Green）
- **红色**（Red）
- **白色**（White）
- **黑色**（Black，透明色，因为背景是黑色）

**默认状态**：黑色（透明）调色盘默认被选中。

### 选择调色盘

1. 点击任意调色盘按钮，该按钮会高亮显示（带边框和阴影）
2. 再次点击已选中的调色盘按钮，可以取消选中
3. 也可以点击其他调色盘按钮切换选择

### 键盘快捷键

- `B`：选择蓝色调色盘
- `G`：选择绿色调色盘
- `R`：选择红色调色盘
- `W`：选择白色调色盘
- `D`：选择黑色（透明）调色盘

## 音符与调色盘的交互规则

### 规则 1：先选调色盘，再点音符

操作流程：
1. 点击调色盘按钮选择颜色（按钮会高亮）
2. 点击目标音符
3. 音符会被着色并变为 visible 状态

### 规则 2：未选中调色盘时的点击行为

如果没有选中任何调色盘（`selectedColor === null`）：

- **点击普通状态的音符**：音符变为 selected 状态（带虚线边框）
- **点击 visible 状态的音符**：音符恢复为普通状态（白色 + 全局可见性设置）

### 规则 3：选中调色盘时的点击行为

如果选中了调色盘（`selectedColor !== null`）：

#### 情况 A：音符颜色与调色盘颜色相同

- **如果音符是 visible 状态**：
  - 第一次点击：音符恢复为普通状态（白色 + 全局可见性）
  - 效果：visible 消失，颜色重置为白色

- **如果音符不是 visible 状态**：
  - 点击：音符变为 visible 状态，保持当前颜色
  - 效果：音符高亮显示

#### 情况 B：音符颜色与调色盘颜色不同

- **无论音符当前是什么状态**：
  - 点击：音符颜色改变为调色盘颜色，并变为 visible 状态
  - 效果：音符被染色并高亮显示

- **再次点击（此时颜色已相同）**：
  - 如果音符是 visible 状态：恢复为普通状态（白色 + 全局可见性）
  - 如果音符不是 visible 状态：变为 visible 状态

### 规则 4：染色优先级大于删除

当选中调色盘时，染色操作的优先级高于删除操作：

1. **第一次点击**：先改变颜色（如果不同）或切换 visible 状态（如果颜色相同）
2. **第二次点击**：如果颜色相同且是 visible，则恢复为普通状态

## 具体交互示例

### 示例 1：普通音符 → 染色

1. 选中红色调色盘
2. 点击普通状态的音符
3. 结果：音符变为红色且 visible

### 示例 2：蓝色 visible 音符 → 用红色调色盘点击

1. 音符当前状态：蓝色 + visible
2. 选中红色调色盘
3. 点击音符
4. 结果：音符变为红色 + visible（颜色改变，保持 visible）

### 示例 3：蓝色 visible 音符 → 用红色调色盘点击两次

1. 第一次点击：音符变为红色 + visible
2. 第二次点击（此时颜色已相同）：
3. 结果：音符恢复为普通状态（白色 + 全局可见性）

### 示例 4：透明色（黑色）visible 音符 → 用透明色调色盘点击

1. 音符当前状态：黑色 + visible
2. 选中黑色调色盘
3. 点击音符
4. 结果：音符恢复为普通状态（白色 + 全局可见性）

### 示例 5：蓝色 visible 音符 → 用透明色（黑色）调色盘点击

1. 第一次点击：音符变为黑色 + visible（颜色改变）
2. 第二次点击：音符恢复为普通状态（白色 + 全局可见性）

### 示例 6：点击 visible 音符（未选中调色盘）

1. 音符当前状态：任意颜色 + visible
2. 确保没有选中调色盘（或取消选中）
3. 点击音符
4. 结果：音符恢复为普通状态（白色 + 全局可见性）

## 其他功能

### 右键重命名

- **操作**：右键点击音符
- **效果**：弹出编辑框，可以修改音符标签文本
- **保存**：按 Enter 键或点击外部区域保存

### 删除音符

- **操作**：选中音符后，点击删除按钮（X）或按 Delete/Backspace 键
- **效果**：音符恢复为普通状态，并清除自定义文本

### Toggle 按钮

- **功能**：切换全局可见性设置
- **状态**：在 `transparent`（半透明）和 `hidden`（完全隐藏）之间切换
- **影响**：影响所有普通状态的音符

### 键盘快捷键

- `B`：选择蓝色调色盘
- `G`：选择绿色调色盘
- `R`：选择红色调色盘
- `W`：选择白色调色盘
- `D`：选择黑色（透明）调色盘
- `Delete` / `Backspace`：删除选中的音符（恢复为普通状态）

## 状态转换图

```
普通状态 (white + transparent/hidden)
    ↓ [选中调色盘 + 点击]
Visible 状态 (任意颜色 + visible)
    ↓ [再次点击（颜色相同）]
普通状态 (white + transparent/hidden)

普通状态 (white + transparent/hidden)
    ↓ [未选中调色盘 + 点击]
Selected 状态 (white + selected)
    ↓ [点击其他地方]
Visible 状态 (white + visible)
```

## 注意事项

1. **调色盘必须先选中**：要染色音符，必须先点击调色盘按钮
2. **默认选中黑色**：页面加载时，黑色（透明）调色盘默认被选中
3. **普通状态的定义**：普通状态 = 白色 + 当前全局可见性设置（由 Toggle 控制）
4. **染色优先**：当选中调色盘时，染色操作优先于其他操作
5. **双击已改为右键**：重命名功能已从双击改为右键点击
